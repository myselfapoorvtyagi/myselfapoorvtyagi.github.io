<svg width="1200" height="460" viewBox="0 0 1200 460" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow4" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#334155" />
    </marker>
  </defs>

  <text x="40" y="36" font-size="20" font-weight="600" fill="#0f172a">Pub/Sub Ingestion and Retry Integration</text>
  <text x="40" y="56" font-size="13" fill="#475569">High-throughput message ingestion with autoscale subscribers and DLQ</text>

  <!-- Producers -->
  <rect x="40" y="120" width="140" height="70" rx="10" fill="#eef2ff" stroke="#6366f1" stroke-width="2"/>
  <text x="110" y="155" font-size="12" text-anchor="middle" fill="#1f2937">Producers</text>
  <text x="110" y="171" font-size="11" text-anchor="middle" fill="#475569">Apps • Devices</text>

  <!-- Pub/Sub -->
  <rect x="220" y="100" width="180" height="110" rx="14" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
  <text x="310" y="140" text-anchor="middle" font-size="14" fill="#b91c1c">Pub/Sub Topic</text>
  <text x="310" y="158" text-anchor="middle" font-size="12" fill="#7f1d1d">Durable buffer • ack-based</text>

  <!-- Subscribers / Processing -->
  <rect x="440" y="80" width="240" height="140" rx="14" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="560" y="130" text-anchor="middle" font-size="14" fill="#92400e">Subscribers (Cloud Run / Dataflow)</text>
  <text x="560" y="148" text-anchor="middle" font-size="12" fill="#92400e">Parallel workers • autoscaled</text>

  <!-- DLQ -->
  <rect x="720" y="120" width="180" height="70" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
  <text x="810" y="155" font-size="12" text-anchor="middle" fill="#b91c1c">Dead-letter Topic</text>

  <!-- BigQuery -->
  <rect x="960" y="90" width="180" height="110" rx="12" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
  <text x="1050" y="130" text-anchor="middle" font-size="14" fill="#1e40af">BigQuery</text>

  <!-- Arrows -->
  <line x1="180" y1="155" x2="220" y2="155" stroke="#334155" stroke-width="2" marker-end="url(#arrow4)"/>
  <line x1="400" y1="155" x2="440" y2="155" stroke="#334155" stroke-width="2" marker-end="url(#arrow4)"/>
  <line x1="680" y1="155" x2="720" y2="155" stroke="#334155" stroke-width="2" marker-end="url(#arrow4)"/>
  <line x1="680" y1="180" x2="960" y2="140" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow4)" stroke-dasharray="4"/>

  <!-- Notes -->
  <rect x="40" y="320" width="1100" height="80" rx="8" fill="#f8fafc" stroke="#eef2ff"/>
  <text x="60" y="346" font-size="12" fill="#0f172a">• Exactly-once processing best-effort via ack/nack and idempotency</text>
  <text x="60" y="364" font-size="12" fill="#0f172a">• Exponential backoff retries (3 attempts) and DLQ routing</text>

  <text x="60" y="420" font-size="13" fill="#16a34a">✅ Resilient ingestion with autoscaled subscribers</text>
</svg>
